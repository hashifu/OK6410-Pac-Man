#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/ioctl.h>
#include <fcntl.h>
#include <linux/fb.h>
#include <sys/mman.h>
#include "lcd/lcd_app.h"
#include <unistd.h>

#define FB_DEV_NAME "/dev/fb0"

#define RED_COLOR565 0x0F100
#define GREEN_COLOR565 0x007E0
#define BLUE_COLOR565 0x0001F

unsigned char MapData[10240] = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x82, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x82, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x82, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x83, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x40, 0x4, 0x0, 0x40, 0x0, 0x0, 0x20, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x40, 0x4, 0x0, 0x40, 0x0, 0x0, 0x20, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x40, 0x4, 0x0, 0x40, 0x0, 0x0, 0x20, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x40, 0x4, 0x0, 0x40, 0x0, 0x0, 0x20, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x40, 0x4, 0x0, 0x40, 0x0, 0x0, 0x20, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x41, 0x4, 0x10, 0x41, 0xff, 0xf8, 0x20, 0xff, 0x82, 0xf, 0xf8, 0x1f, 0xfc, 0x10, 0x7f, 0x4, 0x41, 0x4, 0x10, 0x41, 0x0, 0x0, 0x0, 0x80, 0x2, 0x0, 0x0, 0x0, 0x0, 0x10, 0x40, 0x4, 0x41, 0x4, 0x10, 0x41, 0x0, 0x0, 0x0, 0x80, 0x2, 0x0, 0x0, 0x0, 0x0, 0x10, 0x40, 0x4, 0x41, 0x4, 0x10, 0x41, 0x0, 0x0, 0x0, 0x80, 0x2, 0x0, 0x0, 0x0, 0x0, 0x10, 0x40, 0x4, 0x41, 0x4, 0x10, 0x41, 0x0, 0x0, 0x0, 0x80, 0x2, 0x0, 0x0, 0x0, 0x0, 0x10, 0x40, 0x4, 0x41, 0x0, 0x10, 0x41, 0x0, 0x0, 0x0, 0x80, 0x2, 0x0, 0x0, 0x0, 0x0, 0x10, 0x40, 0x4, 0x41, 0x0, 0x10, 0x41, 0x4, 0x1f, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x7f, 0x4, 0x41, 0x0, 0x10, 0x41, 0x4, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x40, 0x0, 0x0, 0x1, 0x4, 0x41, 0x0, 0x10, 0x1, 0x4, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x40, 0x0, 0x0, 0x1, 0x4, 0x41, 0x0, 0x10, 0x1, 0x4, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x40, 0x0, 0x0, 0x1, 0x4, 0x41, 0x4, 0x10, 0x1, 0x4, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x40, 0x0, 0x0, 0x1, 0x4, 0x41, 0x4, 0x10, 0x1, 0x4, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x40, 0x0, 0x0, 0x1, 0xff, 0x41, 0x4, 0x10, 0x1, 0x4, 0x10, 0x7f, 0xf8, 0x3f, 0xfc, 0x10, 0x40, 0x0, 0x1f, 0xc0, 0x0, 0x41, 0x4, 0x1f, 0xff, 0x4, 0x10, 0x40, 0x0, 0x0, 0x4, 0x10, 0x41, 0xfc, 0x10, 0x40, 0x0, 0x41, 0x4, 0x0, 0x1, 0x4, 0x10, 0x40, 0x0, 0x0,
                           0x4, 0x10, 0x41, 0x4, 0x10, 0x40, 0x0, 0x41, 0x4, 0x0, 0x1, 0x4, 0x10, 0x40, 0x0, 0x0, 0x4, 0x10, 0x41, 0x4, 0x10, 0x40, 0x0, 0x40, 0x4, 0x0, 0x1, 0x4, 0x10, 0x40, 0x0, 0x0, 0x4, 0x10, 0x41, 0x4, 0x1f, 0xc0, 0x0, 0x40, 0x4, 0x0, 0x1, 0x7, 0xf0, 0x40, 0x0, 0x0, 0x4, 0x10, 0x41, 0x4, 0x0, 0x41, 0xff, 0x40, 0x4, 0x0, 0x1, 0x0, 0x0, 0x40, 0x0, 0x0, 0x4, 0x10, 0x41, 0xfc, 0x0, 0x40, 0x4, 0x40, 0x4, 0x1f, 0xc1, 0x0, 0x0, 0x40, 0x0, 0x0, 0x4, 0x10, 0x0, 0x4, 0x0, 0x40, 0x4, 0x40, 0x4, 0x10, 0x41, 0x0, 0x0, 0x40, 0x0, 0x0, 0x4, 0x10, 0x0, 0x4, 0x0, 0x40, 0x4, 0x41, 0x4, 0x10, 0x41, 0x0, 0x0, 0x40, 0x0, 0x0, 0x4, 0x10, 0x0, 0x4, 0x0, 0x40, 0x4, 0x41, 0x4, 0x10, 0x41, 0x0, 0x0, 0x40, 0x0, 0x0, 0x4, 0x10, 0x0, 0x4, 0x10, 0x40, 0x4, 0x41, 0x4, 0x1f, 0xc1, 0xff, 0xf0, 0x40, 0x0, 0x0, 0x4, 0x10, 0x0, 0x4, 0x10, 0x41, 0x4, 0x41, 0x4, 0x0, 0x0, 0x0, 0x10, 0x40, 0x0, 0x0, 0x4, 0x10, 0x7f, 0x4, 0x10, 0x41, 0x4, 0x41, 0x4, 0x0, 0x0, 0x0, 0x10, 0x40, 0x0, 0x0, 0x4, 0x10, 0x41, 0x4, 0x10, 0x41, 0x4, 0x41, 0x4, 0x0, 0x0, 0x0, 0x10, 0x40, 0x0, 0x0, 0x4, 0x10, 0x41, 0x4, 0x10, 0x41, 0x4, 0x41, 0x4, 0x0, 0x0, 0x0, 0x10, 0x7f, 0xff, 0xff, 0xfc, 0x10, 0x41, 0x4, 0x10, 0x41, 0x4, 0x41, 0x4, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x10, 0x41, 0x4, 0x10, 0x41, 0x4, 0x41, 0xff, 0xf0, 0x7f, 0xfc, 0x0, 0x0, 0x0, 0x0, 0x4, 0x10, 0x41, 0x4, 0x10, 0x41, 0x4, 0x40, 0x0, 0x0, 0x0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x4, 0x10, 0x7f, 0x4, 0x10, 0x7f, 0x4, 0x40, 0x0, 0x0, 0x0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x4, 0x10, 0x0, 0x0, 0x10, 0x0, 0x4, 0x40, 0x0, 0x0, 0x0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x4, 0x10, 0x0, 0x0, 0x10, 0x0, 0x4, 0x40, 0x0, 0x0, 0x0, 0x7, 0xff, 0xf8, 0x3f, 0xe0, 0xfc, 0x10, 0x0, 0x0, 0x10, 0x0, 0x4, 0x40, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x20, 0x20, 0x0, 0x10, 0x0, 0x0, 0x10, 0x0, 0x4, 0xff, 0xf0, 0x7f, 0xff, 0x0, 0x0, 0x8, 0x3f, 0xe0, 0x0, 0x10, 0x0, 0x0, 0x10, 0x0, 0x4, 0x0, 0x0, 0x0, 0x1, 0x0, 0x0, 0x8, 0x0, 0x20, 0x0, 0x10, 0x7f, 0xff, 0xf0, 0x7f, 0x4, 0x0, 0x0, 0x0, 0x1, 0x0, 0x0, 0x8, 0x0, 0x20, 0x0, 0x10, 0x40, 0x0, 0x0, 0x40, 0x4, 0x0, 0x0, 0x0, 0x1,
                           0x0, 0x0, 0x8, 0x0, 0x20, 0x0, 0x10, 0x40, 0x0, 0x0, 0x40, 0x4, 0x0, 0x0, 0x0, 0x1, 0x7, 0x82, 0x8, 0x0, 0x20, 0xff, 0xf0, 0x40, 0x0, 0x0, 0x40, 0x4, 0x0, 0x0, 0x0, 0x1, 0x4, 0x82, 0x8, 0x0, 0x20, 0x0, 0x0, 0x40, 0x0, 0x0, 0x40, 0x4, 0x4, 0x10, 0x78, 0x3f, 0x7, 0x82, 0x8, 0x38, 0x20, 0x0, 0x0, 0x40, 0x0, 0x0, 0x40, 0x4, 0x4, 0x10, 0x48, 0x20, 0x0, 0x82, 0x8, 0x28, 0x20, 0x0, 0x0, 0x41, 0xfc, 0x1f, 0xc1, 0x4, 0x4, 0x10, 0x48, 0x20, 0x0, 0x82, 0x8, 0x28, 0x20, 0x0, 0x0, 0x41, 0x4, 0x10, 0x41, 0x4, 0x4, 0x10, 0x48, 0x20, 0x0, 0x82, 0x8, 0x28, 0x20, 0x0, 0x0, 0x41, 0x4, 0x10, 0x41, 0x4, 0x4, 0x10, 0x48, 0x20, 0x0, 0xfe, 0x8, 0x38, 0x3f, 0xff, 0xff, 0xc1, 0xfc, 0x1f, 0xc1, 0x4, 0x4, 0x10, 0x48, 0x20, 0x0, 0x82, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x4, 0x4, 0x10, 0x78, 0x20, 0xe0, 0x82, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x4, 0x4, 0x10, 0x0, 0x0, 0x20, 0x82, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x4, 0x0, 0x10, 0x0, 0x0, 0x20, 0x80, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x4, 0x0, 0x10, 0x0, 0x0, 0x20, 0x80, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x4, 0x0, 0x10, 0x0, 0x0, 0x20, 0x80, 0xf, 0xf8, 0x3f, 0xf0, 0x7f, 0xc1, 0xfc, 0x1f, 0xc1, 0xff, 0x0, 0x10, 0x0, 0x0, 0x20, 0x80, 0x8, 0x8, 0x20, 0x10, 0x40, 0x41, 0x4, 0x10, 0x41, 0x0, 0x0, 0x1f, 0xff, 0xff, 0xe0, 0x80, 0x8, 0x8, 0x20, 0x10, 0x40, 0x41, 0x4, 0x10, 0x41, 0x0, 0xff, 0xf0, 0x0, 0x0, 0x20, 0xff, 0xf8, 0x8, 0x20, 0x10, 0x40, 0x41, 0x4, 0x10, 0x41, 0x0};
// 地图数据
unsigned char douData[10240] = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xa, 0xa0, 0xa8, 0x5, 0x55, 0x55, 0x5, 0x55, 0x55, 0x54, 0x2a, 0xaa, 0xaa, 0xaa, 0xaa, 0xa0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x20, 0x80, 0x8, 0x0, 0x1, 0x4, 0x0, 0x10, 0x40, 0x0, 0x80, 0x0, 0x82, 0x0, 0x20, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x20, 0x80, 0x8, 0x0, 0x1, 0x4, 0x0, 0x10, 0x40, 0x0, 0x80, 0x0, 0x82, 0x0, 0x20, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x20, 0x80, 0x8, 0xa, 0xaa, 0xa4, 0x15, 0x50, 0x2a, 0xaa, 0xaa, 0xaa, 0x82, 0x2, 0xa0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x20, 0x80, 0x8, 0x0, 0x80, 0x4, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x0, 0x0, 0x2, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x2a, 0x80, 0x8, 0x0, 0x80, 0x4, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x0, 0x0, 0x2, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x20, 0x0, 0x8, 0x0, 0x81, 0x55, 0x55, 0x55, 0x54, 0xaa, 0xa, 0xaa, 0xaa, 0xa0, 0x20, 0x0, 0x0, 0x82, 0xa0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x0, 0x8, 0x20, 0x0, 0x0, 0x0, 0x82, 0x0, 0x0, 0x0, 0x0, 0x2, 0x8, 0x0, 0x80, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x8, 0x0, 0x8, 0x20, 0x0, 0x0, 0x0, 0x82, 0x0, 0x0, 0x0, 0x0, 0x2, 0x8, 0x0, 0x80, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0xa, 0xaa, 0x0, 0x20, 0x0, 0x0,
                           0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0x8, 0x0, 0x80, 0x0, 0x0, 0x8, 0x0, 0xaa, 0xa8, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x8, 0x0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0x8, 0x0, 0x80, 0x0, 0x0, 0x5, 0x40, 0x80, 0x8, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x8, 0x0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0x8, 0x0, 0xaa, 0x0, 0x0, 0x8, 0x0, 0x80, 0x8, 0x2a, 0xa8, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0xa, 0xa0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0xaa, 0xa0, 0x82, 0x0, 0x0, 0x8, 0x0, 0x80, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x8, 0x20, 0x0, 0x20, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x82, 0x0, 0x0, 0x8, 0x0, 0x80, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x8, 0x20, 0x0, 0x20, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x82, 0x0, 0x0, 0x8, 0x0, 0xaa, 0xaa, 0xaa, 0x80, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x8, 0x20, 0x0, 0x20, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x82, 0x0, 0x0, 0x8, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x0, 0x8, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x82, 0x0, 0x0, 0x8, 0x0, 0x0, 0x0, 0x0, 0xa8, 0xaa, 0xaa, 0xa5, 0x50, 0x80, 0x0, 0x0, 0x0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x20, 0x82, 0x0, 0x0, 0xa, 0xaa, 0xaa, 0xaa, 0xa0, 0x0, 0x1, 0x0, 0x4, 0x0, 0x80, 0x0, 0x0, 0x0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0xaa, 0xaa, 0x82, 0xaa, 0x80, 0x0, 0x2, 0x0, 0x0, 0x20, 0x0, 0x1, 0x0, 0x4, 0x0, 0x80, 0x0, 0x0, 0x0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x2a, 0xaa, 0x81, 0x0, 0x2, 0xaa, 0x80, 0x0, 0x0, 0x0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x2, 0x0, 0x0, 0x15, 0x52, 0x55, 0x50, 0x20, 0x10, 0x40, 0xaa, 0x4, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0xa,
                           0xaa, 0xaa, 0x2, 0x80, 0x20, 0x82, 0x1, 0x0, 0x20, 0x10, 0x41, 0x1, 0x4, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x80, 0x0, 0x0, 0x20, 0x82, 0x1, 0x0, 0x20, 0x10, 0x41, 0x1, 0x2, 0xaa, 0xa8, 0x8, 0x0, 0x0, 0x8, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x20, 0x82, 0x1, 0x2, 0xa8, 0x0, 0x41, 0x1, 0x0, 0x0, 0x0, 0x8, 0x0, 0x0, 0x8, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x0, 0x0, 0x20, 0x82, 0x1, 0x4, 0x4, 0x0, 0x41, 0x1, 0x0, 0x0, 0x0, 0x8, 0x0, 0x0, 0x8, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x20, 0x82, 0x1, 0x4, 0x4, 0x0, 0x41, 0x55, 0x55, 0x52, 0x55, 0x49, 0x55, 0x55, 0x48, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x20, 0x82, 0xa9, 0x54, 0x4, 0x0, 0x40, 0x1, 0x0, 0x2, 0x0, 0x8, 0x0, 0x80, 0x8, 0x0, 0xa, 0x0, 0x0, 0x0, 0x0, 0x15, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x4, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x8, 0x0, 0x80, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xff, 0xc0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0};
// 豆子数据
unsigned char ShowData[10240] = {0};
// 真正展现的数据
unsigned char daliwan[4][4] = {{40, 23, 1, 1}, {43, 57, 1, 1}, {116, 12, 0, 1}, {122, 57, 1, 1}}; // 四颗大力丸位置
unsigned char x[5] = {63, 56, 63, 70, 63}, y[5] = {62, 28, 28, 28, 33};
unsigned char direction[5];
unsigned char dead[5] = {0};
unsigned char mydirect = 0;
int dalitime = 0;              // 大力时间
unsigned char fensantime = 20; // 分散时间
int score = 0;                 // 分数
unsigned char fanxiang(unsigned char a)
{
    unsigned char fan[4] = {1, 0, 3, 2};
    return fan[a];
}
void changebit(unsigned char x, unsigned char y, unsigned char *list)
{
    list[16 * y + x / 8] ^= (1 << (7 - x % 8));
}
void setbit(unsigned char x, unsigned char y, unsigned char *list, unsigned char what)
{
    if (what)
        list[16 * y + x / 8] |= (1 << (7 - x % 8));
    else
        list[16 * y + x / 8] &= ~(1 << (7 - x % 8));
}
unsigned char checkbit(unsigned char x, unsigned char y, unsigned char *list)
{
    return ((list[16 * y + x / 8] & (1 << (7 - x % 8))) == 0 ? 0 : 1);
}
void update(void)
{
    static unsigned char ii = 0;
    int i;
    unsigned char j, k;
    for (i = 0; i < 1024; i++)
    {
        ShowData[i] = douData[i] | MapData[i];
    }
    for (j = 0; j < 5; j++)
    {
        if (dead[j] == 1)
            continue;
        else
        {
            ii = 1 - ii;
            setbit(x[j], y[j], ShowData, 1);
            setbit(x[j] + 1, y[j] + 1, ShowData, 1);
            setbit(x[j] - 1, y[j] - 1, ShowData, 1);
            setbit(x[j] + 1, y[j] - 1, ShowData, 1);
            setbit(x[j] - 1, y[j] + 1, ShowData, 1);
            if (dalitime == 0 || (dalitime < 50 && ii == 0) || j == 0)
            {
                setbit(x[j], y[j] + 1, ShowData, 1);
                setbit(x[j] - 1, y[j], ShowData, 1);
                setbit(x[j] + 1, y[j], ShowData, 1);
                setbit(x[j], y[j] - 1, ShowData, 1);
            }
        }
    }
    for (k = 0; k < 4; k++)
    {
        if (daliwan[k][3] == 0)
            continue;
        setbit(daliwan[k][0], daliwan[k][1], ShowData, 1);
        if (daliwan[k][2])
        {
            setbit(daliwan[k][0] - 1, daliwan[k][1], ShowData, 1);
            setbit(daliwan[k][0] + 1, daliwan[k][1], ShowData, 1);
        }
        else
        {
            setbit(daliwan[k][0], daliwan[k][1] - 1, ShowData, 1);
            setbit(daliwan[k][0], daliwan[k][1] + 1, ShowData, 1);
        }
    }
}
unsigned char whats(unsigned char m, unsigned char n)
{
    unsigned char i, j;
    for (i = 1; i <= 4; i++)
    {
        if (m == x[i] && n == y[i] && !dead[i])
            return 1;
    }
    if (checkbit(m, n, douData))
        return 2;
    if (checkbit(m, n, MapData))
        return 3;
    for (j = 0; j < 4; j++)
    {
        if (m == daliwan[j][0] && n == daliwan[j][1] && daliwan[j][3] != 0)
        {
            return 4;
        }
    }
    return 0;
} // 0blank 1guai 2douzi 3wall 4daliwan
unsigned char zq(int x, int y)
{
    int i, j;
    for (i = -2; i <= 2; i++)
    {
        for (j = -2; j <= 2; j++)
        {
            if (whats(x + i, y + j) == 3)
                return 1;
            if (x + i < 0 || x + i > 127)
                return 1;
            if (y + j < 0 || y + j > 63)
                return 1;
        }
    }
    return 0;
}
int deltax(unsigned char direction)
{
    switch (direction)
    {
    case 0:
        return 0;
    case 1:
        return 0;
    case 2:
        return -1;
    case 3:
        return 1;
    }
}
int deltay(unsigned char direction)
{
    switch (direction)
    {
    case 0:
        return -1;
    case 1:
        return 1;
    case 2:
        return 0;
    case 3:
        return 0;
    }
}
unsigned char zoulu(unsigned char keydown, unsigned char newdirection)
{ // 0up 1down 2left 3 right
    unsigned char what = 5;
    unsigned char newx = x[0] + deltax(newdirection), newy = y[0] + deltay(newdirection);
    if (keydown)
    {
        if (!zq(newx, newy))
        {
            what = whats(newx, newy);
        }
    }
    unsigned char i, j, k;
    switch (what)
    {
    case 4:
        for (i = 0; i < 4; i++)
        {
            if (daliwan[i][0] == newx && daliwan[i][1] == newy)
            {
                daliwan[i][3] = 0;
                break;
            }
        }
        for (j = 1; j <= 4; j++)
        {
            direction[j] = fanxiang(direction[j]);
        }

        x[0] = newx;
        y[0] = newy;
        direction[0] = newdirection;
        dalitime = 100;
        break;
    case 2:
        setbit(newx, newy, douData, 0);
        score++;
        // char str[30];
        // sprintf(str, "title score=%d", score);
        // system(str);
        x[0] = newx;
        y[0] = newy;
        direction[0] = newdirection;
        break;
    case 0:
        x[0] = newx;
        y[0] = newy;
        direction[0] = newdirection;
        break;
    case 1:
        if (dalitime > 0)
        {
            for (k = 1; k <= 4; k++)
            {
                if (x[k] == newx && y[k] == newy)
                {
                    dead[k] = 1;
                    score += 20;
                    break;
                }
            }
        }
        else
        {
            char str[30];
            printf("Your score=%d\n", score);
            printf("You died.");
            exit(0);
        }
        break;
    }
    return 0;
}
unsigned char autoi()
{
    int targetx[5], targety[5];
    unsigned char i, j, k;
    if (fensantime > 0)
    {
        targetx[1] = 127;
        targety[1] = 0;
        targetx[2] = 127;
        targety[2] = 0;
        targetx[3] = 0;
        targety[3] = 0;
        targetx[4] = 0;
        targety[4] = 0;
    }
    else
    {
        targetx[1] = x[0];
        targety[1] = y[0];
        targetx[2] = 2 * x[0] - x[1];
        targety[2] = 2 * y[0] - y[1];
        targetx[3] = x[0] + 8 * deltax(direction[0]);
        targety[3] = y[0] + 8 * deltay(direction[0]);
        if (abs(x[4] - x[0]) + abs(y[4] - y[0]) > 32)
        {
            targetx[4] = x[0];
            targety[4] = y[0];
        }
        else
        {
            targetx[4] = 0;
            targety[4] = 0;
        }
    }
    for (i = 1; i <= 4; i++)
    {
        if (dead[i])
            continue;
        int bestdirection;
        int bestdist = dalitime > 0 ? 0 : 255;
        for (j = 0; j < 4; j++)
        {
            int newx = x[i] + deltax(j);
            int newy = y[i] + deltay(j);
            if (zq(newx, newy))
                continue;

            if (dalitime == 0)
            {
                int thisdist = abs(newx - targetx[i]) + abs(newy - targety[i]);
                if (fanxiang(j) == direction[i])
                    thisdist += 30;
                if (thisdist < bestdist)
                {
                    bestdist = thisdist;
                    bestdirection = j;
                }
            }
            else
            {
                int thisdist = rand();
                if (fanxiang(j) == direction[i])
                    thisdist = 1;
                if (thisdist > bestdist)
                {
                    bestdist = thisdist;
                    bestdirection = j;
                }
            }
        }
        x[i] += deltax(bestdirection);
        y[i] += deltay(bestdirection);
        direction[i] = bestdirection;
        if (x[i] == x[0] && y[i] == y[0])
        {
            if (dalitime > 0)
            {
                dead[i] = 1;
            }
            else
            {
                char str[30];
                printf("Your score=%d\n", score);
                printf("You died.");
                exit(0);
            }
        }
    }
    if (fensantime == 1)
    {
        fensantime = 0;
        for (k = 0; k < 5; k++)
        {
            setbit(61 + k, 21, MapData, 1);
        }
    }
    else if (fensantime > 0)
        fensantime--;
    if (dalitime > 0)
        dalitime--;
    return 0;
}

void LCD_Display_Picture(unsigned char *img, fb_dev_t *fbd)
{
    int x = 0, y = 0;
    for (x = 0; x < 128; x++)
    {
        for (y = 0; y < 64; y++)
        {
            if ((img[16 * y + x / 8] >> (7 - x % 8)) % 2)
            {
                fb_drawrect(fbd, (int)(3.75f*x), (int)(4.25f*y), (int)(3.75f*(x+1))-(int)(3.75f*x), (int)(4.25f*(y+1))-(int)(4.25f*y), RED_COLOR565);
            }
            else
            {
                fb_drawrect(fbd, (int)(3.75f*x), (int)(4.25f*y), (int)(3.75f*(x+1))-(int)(3.75f*x), (int)(4.25f*(y+1))-(int)(4.25f*y), GREEN_COLOR565);
            }
        }
    }
}

int main(int argc, char *argv[])
{
    fb_dev_t *fbd;
    int fd;
    int val;
    int key_value[4];

    fd = open("/dev/keyint", O_RDWR | O_NONBLOCK);
    if (fd < 0)
    {
        printf("open devie error\n");
        return -1;
    }
    fbd = (fb_dev_t *)malloc(sizeof(fb_dev_t));
    fb_open(fbd, FB_DEV_NAME);
    if (fbd->bpp != 16)
    {
        exit(-1);
    }
    fb_drawrect(fbd, 0, 0, fbd->xres, fbd->yres, GREEN_COLOR565);
    while (1)
    {
        val = read(fd, key_value, sizeof(key_value));
        int status = 0;
        if (val >= 0)
        {
            if (key_value[0])
            {
                status = zoulu(1, 0);
            }
            else if (key_value[1])
            {
                status = zoulu(1, 1);
            }
            else if (key_value[2])
            {
                status = zoulu(1, 2);
            }
            else if (key_value[3])
            {
                status = zoulu(1, 3);
            }
        }
        else
        {
            status = zoulu(0,1);
        }
        autoi();
        update();
        if (status == 1)
        {
            break;
        }
        if (status == 0)
        {
            LCD_Display_Picture(ShowData, fbd);
        }
        usleep(500 * 1000);
    }
    fb_close(fbd);
}